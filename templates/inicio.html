{% extends "base.html" %}
{% block content %}

<h2 class="text-center mb-4">
  <span class="badge bg-success">Productos Disponibles</span>
</h2>

<!-- Barra de categor√≠as con botones 3D biselados -->
<div class="mb-4 d-flex flex-wrap justify-content-center">
  <a href="/" class="btn-categoria todos">üè† Todos</a>
  {% for cat in todas_categorias %}
    {% set estilo = categoria_estilos.get(cat.nombre, {"icono": "üå±"}) %}
    <a href="/categoria/{{ cat.id }}" class="btn-categoria">
      {{ estilo.icono }} {{ cat.nombre }}
    </a>
  {% endfor %}
</div>

<!-- Lista de productos -->
{% if productos %}
  <div class="row g-4">
  {% for p in productos %}
    {% set estilo = categoria_estilos.get(p.categoria.nombre, {"icono": "üå±", "color": "#ffffff"}) %}
    <div class="col-md-6 col-lg-4">
      <div class="card h-100" style="background-color: {{ estilo.color }}; border-left: 4px solid #28a745;">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start">
            <h5 class="card-title mb-1">
              {{ estilo.icono }} {{ p.nombre }}
              <small class="text-muted ms-2">#{{ p.id }}</small>
            </h5>
            {% if p.productor.es_premium %}
              <span class="badge-premium">‚≠ê Premium</span>
            {% endif %}
          </div>
          <p class="card-text flex-grow-1">
            <strong>Productor:</strong> {{ p.productor.nombre }}<br>
            <strong>Finca:</strong> {{ p.productor.finca or "No especificada" }}<br>
            <strong>Tel√©fono:</strong> {{ p.productor.telefono }}<br>
            <strong>Categor√≠a:</strong> {{ p.categoria.nombre }}<br>
            <strong>Cantidad:</strong> {{ p.cantidad }} {{ p.unidad }}<br>
            <strong>Precio:</strong> ${{ "{:,.0f}".format(p.precio) }}<br>
            {% if p.descripcion %}<small class="text-muted">{{ p.descripcion }}</small>{% endif %}
          </p>
          <a href="https://wa.me/57{{ p.productor.telefono|replace(' ', '')|replace('+', '') }}?text=Hola,%20vi%20tu%20oferta%20de%20{{ p.nombre|urlencode }}%20en%20La%20Tiendita" 
             class="btn btn-3d mb-2" target="_blank">
             üì± Contactar por WhatsApp
          </a>
          {% if not p.productor.es_premium %}
            <a href="https://wa.me/573143539351?text=Hola,%20quiero%20activar%20mi%20plan%20Premium%20de%20$10.000%20mensuales" 
               class="btn btn-warning btn-sm w-100">
               ‚≠ê Quiero ser Premium ($10.000/mes)
            </a>
          {% endif %}
          <!-- Bot√≥n actualizado: Producto agotado -->
          <a href="https://wa.me/573143539351?text=Hola,%20mi%20producto%20ID%20{{ p.id }}%20ya%20est√°%20agotado.%20Por%20favor,%20ret√≠ralo%20de%20La%20Tiendita." 
             class="btn btn-outline-3d mt-2" target="_blank">
            üì¶ Producto agotado
          </a>
        </div>
      </div>
    </div>
  {% endfor %}
  </div>
{% else %}
  <div class="text-center py-5">
    <p class="text-muted fs-5">No hay productos disponibles en esta categor√≠a.</p>
    <a href="/publicar" class="btn btn-3d mt-3">+ Publicar tu primer producto</a>
  </div>
{% endif %}

{% endblock %}